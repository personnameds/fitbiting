<!DOCTYPE html>
<html>
<head>
	<title>Create a Route</title>
	<meta name="viewport" content="initial-scale=1.0">
	<meta charset="utf-8">
	<style>
		/* Always set the map height explicitly to define the size of the div
		* element that contains the map. */
		#map {
			float: right;
			height: 100%;
			width: 70%
		}
      	/* Optional: Makes the sample page fill the window. */
      	html, body {
			height: 100%;
			margin: 0;
			padding: 10px;
      	}
	</style>
</head>
  	
<body>	
    <div id="map"></div>
 
	<h3><a href="{% url 'homepage-index' %}">Homepage</a></h3>
	<h3><a href="{% url 'admin:index' %}">Admin</a></h3>  
	
	<p>Create Route</p>
	<form action="{% url 'createroute' %}" id="route_form" method="POST">{%csrf_token %}
		{{ form.as_p }}
		<input type="button" id="check" value="Check Route">
		<input type="submit" id="save" value="Save Route">
	</form>    
<!--Include a hidden field that toggles when check route returns OK -->

    <script>    	
//    	document.getElementById('save').style.visibility = 'hidden';
      	
      	function initMap() {
			var directionsService = new google.maps.DirectionsService;
			var directionsDisplay = new google.maps.DirectionsRenderer;
	
			var start = document.getElementById('start');
			var end = document.getElementById('end');
			var autocomplete_start = new google.maps.places.Autocomplete(start);
			var autocomplete_end = new google.maps.places.Autocomplete(end);
	
			var map = new google.maps.Map(document.getElementById('map'), {
			  center: {lat: 43.65, lng: -79.38},
			  zoom: 9
			});
			directionsDisplay.setMap(map);
	
			document.getElementById('check').onclick=function() {
				calculateAndDisplayRoute(directionsService, directionsDisplay);
			};

		}
      	
		function calculateAndDisplayRoute(directionsService, directionsDisplay) {
			directionsService.route({
			  origin: document.getElementById('start').value,
			  destination: document.getElementById('end').value,
			  travelMode: 'WALKING',
			  avoidFerries: true,
			}, function(response, status) {
			  if (status === 'OK') {
			
				directionsDisplay.setDirections(response);
				document.getElementById('status').value = 'OK';
				document.getElementById('start_lat').value = response.routes[0].legs[0].start_location.lat().toFixed(6);	  
				document.getElementById('start_long').value = response.routes[0].legs[0].start_location.lng().toFixed(6);
				document.getElementById('end_lat').value = response.routes[0].legs[0].end_location.lat().toFixed(6);
				document.getElementById('end_long').value = response.routes[0].legs[0].end_location.lng().toFixed(6);
				console.log(document.getElementById('end_long').value);		
			  
			  } else {
				window.alert('Directions request failed due to ' + status);
			  }
        	});
        }
 		
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{API_KEY}}&libraries=places&callback=initMap" async defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  </body>
</html>

